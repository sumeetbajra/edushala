var rs = require('./misc/rs');

var client = rs.classy.define({
    forceInstance: true,
    init: function (cfg) {
        rs.util.apply(this, cfg);
        if(!this.conn && rs.config.has('app.db.conn')) {
            this.conn = rs.config.get('app.db.conn');
        }

        if(!this.conn)
            throw rs.error('No database connection specified');

        this.type = cfg.type || 'mongodb';

        console.log(this.type);

        //select appropriate database
        var dbCls = require('./db/' + cfg.type);
        this.db = dbCls({conn: this.conn});
    }
});

module.exports = client;