var rs = require('../misc/rs');
var express = require('express');
var router = express.Router();

module.exports = function (context) {
    var svc_auth = context.service.auth;
    var params;

    router.all('*', function (req, res, next) {
        params = {};
        params.success = function (results) {
            res.send(results);
        };
        params.failure = function (error) {
            var err = new Error(error);
            err.status = 404;
            next(err);
        };
        params.data = req.body;
        next();
    });

    router.post('/', function (req, res, next) {
        svc_auth.login(params);
    });

    router.post('/password/forgot', function (req, res, next) {
        svc_auth.forgotPassword(params);
    });

    router.post('/password/change', function (req, res, next) {
        svc_auth.changePassword(params);
    });

    router.post('/password/reset', function (req, res, next) {
        svc_auth.login(params);
    });
    return router;
};