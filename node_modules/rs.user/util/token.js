var rs = require('../misc/rs');

var token = rs.classy.define({
    extend: rs.util.token,
    forceInstance: true,
    init: function (jwt) {
        if(typeof(jwt)=='string')
            this.jwt = jwt;
        this.secret = rs.config.get('rs.secret');
        this.callSuper();
    },
    hasRole: function(role){
        try {
            var payload = this.verify(this.jwt);
            return rs.util.array.exists(payload.data.roles, role);
        } catch (ex) {
            return false;
        }
    },
    hasPermission: function(permission){
        try {
            var payload = this.verify(this.jwt);
            return rs.util.array.exists(payload.data.permissions, permission);
        } catch (ex) {
            return false;
        }
    }
});

module.exports = token;